Index: gdk-pixbuf-2.31.1/gdk-pixbuf/io-tiff.c
===================================================================
--- gdk-pixbuf-2.31.1.orig/gdk-pixbuf/io-tiff.c	2014-03-06 05:36:45.000000000 +0100
+++ gdk-pixbuf-2.31.1/gdk-pixbuf/io-tiff.c	2019-12-20 11:41:41.794773539 +0100
@@ -41,6 +41,17 @@
 #define lseek(a,b,c) _lseek(a,b,c)
 #define O_RDWR _O_RDWR
 #endif
+
+/*
+ * this has to be added here to support g_uint_checked_mul() from the patch
+ * for CVE-2017-6314
+ */
+static inline gboolean _GLIB_CHECKED_MUL_U32 (guint32 *dest, guint32 a, guint32 b) {
+  *dest = a * b; return !a || *dest / a == b; }
+
+#define g_uint_checked_mul(dest, a, b) \
+    _GLIB_CHECKED_MUL_U32(dest, a, b)
+
 
 
 typedef struct _TiffContext TiffContext;
@@ -458,8 +469,15 @@
         need_alloc = context->used + needed;
         if (need_alloc > context->allocated) {
                 guint new_size = 1;
-                while (new_size < need_alloc)
-                        new_size *= 2;
+                while (new_size < need_alloc) {
+                        if (!g_uint_checked_mul (&new_size, new_size, 2)) {
+                                new_size = 0;
+                                break;
+                        }
+                }
+
+                if (new_size == 0)
+                        return FALSE;
 
                 new_buffer = g_try_realloc (context->buffer, new_size);
                 if (new_buffer) {

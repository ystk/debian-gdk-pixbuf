Index: gdk-pixbuf-2.31.1/gdk-pixbuf/io-ico.c
===================================================================
--- gdk-pixbuf-2.31.1.orig/gdk-pixbuf/io-ico.c	2019-12-18 20:04:38.008909741 +0100
+++ gdk-pixbuf-2.31.1/gdk-pixbuf/io-ico.c	2019-12-18 20:06:57.283835487 +0100
@@ -23,6 +23,9 @@
  */
 
 #undef DUMPBIH
+
+#define INFOHEADER_SIZE 40
+
 /*
 
 Icons are just like BMP's, except for the header.
@@ -290,10 +293,8 @@
 			return;
 		}
 
-		/* We know how many bytes are in the "header" part. */
-		State->HeaderSize = entry->DIBoffset + 40; /* 40 = sizeof(InfoHeader) */
-
-		if (State->HeaderSize < 0) {
+                /* Avoid invoking undefined behavior in the State->HeaderSize calculation below */
+                if (entry->DIBoffset > G_MAXINT - INFOHEADER_SIZE) {
 			g_set_error_literal (error,
 			                     GDK_PIXBUF_ERROR,
 			                     GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
@@ -301,6 +302,9 @@
 			return;
 		}
 
+		/* We know how many bytes are in the "header" part. */
+		State->HeaderSize = entry->DIBoffset + INFOHEADER_SIZE;
+
 		if (State->HeaderSize>State->BytesInHeaderBuf) {
 			guchar *tmp=g_try_realloc(State->HeaderBuf,State->HeaderSize);
 			if (!tmp) {
